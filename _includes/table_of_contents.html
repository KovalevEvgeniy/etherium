{% capture table_of_contents %}
<ul>
    {% assign headings = page.content | markdownify | split: '<h4' %}
    {% for heading in headings offset:1 %}
    {% if heading contains '</h4>' %}
    {% assign heading_parts = heading | split: '</h4>' %}
    {% assign heading_parts2 = heading_parts[0] | split: '>' %}
    {% assign heading_text = heading_parts2[1] | strip_html | strip %}
    {% if heading_text != "" %}
    {% assign heading_id = heading_text | slugify %}
    <li>
        <a href="#{{ heading_id }}">{{ heading_text }}</a>
    </li>
    {% endif %}
    {% endif %}
    {% endfor %}
</ul>
{% endcapture %}

{% assign h4_count = page.content | markdownify | split: '<h4' | size | minus: 1 %}
{% if h4_count > 0 %}
<div class="table-of-contents">
    {{ table_of_contents }}
</div>
{% endif %}