{% capture table_of_contents %}
<ul>
    {% assign headings = page.content | markdownify | split: '<h2' %}
    {% for heading in headings %}
    {% if heading contains '>' %}
    {% assign heading_parts = heading | split: '>' %}
    {% assign heading_text = heading_parts[1] | split: '</h2' | first | strip_html | strip %}
    {% assign heading_id = heading_text | slugify %}
    <li>
        <a href="#{{ heading_id }}">{{ heading_text }}</a>
    </li>
    {% endif %}
    {% endfor %}
</ul>
{% endcapture %}

{% assign h2_count = page.content | markdownify | split: '<h2' | size | minus: 1 %}
{% if h2_count > 0 %}
<div class="table-of-contents">
    <h2>Оглавление</h2>
    {{ table_of_contents }}
</div>
{% endif %}